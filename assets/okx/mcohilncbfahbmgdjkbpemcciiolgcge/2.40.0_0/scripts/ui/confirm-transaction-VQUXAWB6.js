import{a as Yn}from"./chunk-XFW77OZT.js";import{a as $n,b as Hn,c as Un,d as Rn,e as Bn,g as Go}from"./chunk-JCASDMPT.js";import"./chunk-TL6DTDXH.js";import"./chunk-XKAB6HLO.js";import"./chunk-LDTVDPAV.js";import{a as So}from"./chunk-EQU2E42M.js";import{t as $e}from"./chunk-Z3F5FSEH.js";import{b as Cn}from"./chunk-HXYG5WFL.js";import{b as He,f as Ue}from"./chunk-POEDNLGY.js";import{b as Fn}from"./chunk-JHZWQWSH.js";import"./chunk-IWZNXKTF.js";import"./chunk-3HAJNEFC.js";import"./chunk-APQAOS3P.js";import"./chunk-QYLV6ZSX.js";import"./chunk-Z2IGO6V3.js";import"./chunk-MFUKPLPN.js";import{b as Gn,l as q,m as bn,n as Dn,o as Mn,p as Ln}from"./chunk-TV2DN7Q7.js";import"./chunk-MXVCAI6G.js";import"./chunk-PGO4M2SB.js";import"./chunk-4SCEKLXQ.js";import"./chunk-RYMLTDAH.js";import"./chunk-VNM7HA44.js";import"./chunk-ZHOBAN7R.js";import"./chunk-TNSQYVIA.js";import"./chunk-65FA4JB3.js";import{b as kn,c as ft}from"./chunk-KWSHYTX5.js";import{Ha as Tn,K as ae,Y as fn,ca as ie,ra as _n}from"./chunk-SBW523XW.js";import"./chunk-NEW56Z2U.js";import"./chunk-ZC3KOV3J.js";import"./chunk-GGV226OL.js";import"./chunk-4DLG5GSZ.js";import"./chunk-H5E7HL55.js";import"./chunk-LN5KNA7T.js";import{g as Sn}from"./chunk-HX34N4W4.js";import"./chunk-F7QJ6WQ5.js";import{a as se}from"./chunk-TNVBYBO5.js";import{K as ko,Sa as En,Va as Fo,_a as Pn,bb as wn,c as Pe,db as Ot,i as hn,ia as vn,l as ce,o as In,pb as On,qa as k,z as yn}from"./chunk-KRRNVCWZ.js";import{$ as xr,$b as Ge,Aa as Xo,Al as An,Bg as ze,Cb as Kt,Cg as Ke,Dg as Ze,Gb as Jo,Gd as ee,Gk as ne,Hc as oe,Hf as R,Hk as wt,Ih as nn,Ik as re,Jd as Le,Jh as rn,Jk as qt,La as xo,Lb as te,Mi as A,Mk as E,Na as dt,Ni as Vt,Nk as b,Oi as ho,Pa as Z,Pf as Co,Pg as Ve,Pi as Io,Qi as yo,Rg as qe,Ri as vo,Sg as Qe,Si as Eo,Tg as S,Ti as Po,Ub as ke,Ui as wo,Vb as Fe,Vg as Xe,Vi as Oo,Wg as Je,Yg as tn,Zh as an,_a as Oe,_f as Zt,ae as Re,ce as No,de as Ao,dg as ut,e as C,ee as g,el as gn,fe as V,g as ve,ga as Ee,he as L,i as c,ie as Be,ig as et,ii as Pt,ja as G,je as Ye,k as m,ke as We,lj as pn,me as je,mj as ln,na as we,nd as be,oa as Qo,oi as sn,pi as cn,qi as mn,rh as on,ta as zt,tg as W,tk as dn,ud as De,vk as un,wa as O,wd as Me,wh as en,yl as xn,zb as Se,zl as Nn}from"./chunk-YC2Z7II3.js";c();m();c();m();c();m();var P=C(G()),H=C(Qo());c();m();var n=C(G());var Mo=C(we());var Do=C(Pe());var rr=C(xr());var _e=C(se());c();m();var _t=C(G()),Q=C(Qo());var me=({index:t=0,total:e=0,prevHandle:o,nextHandle:r})=>{let i=k();return _t.default.createElement("div",{className:"confirm-transaction--flag"},_t.default.createElement("div",{onClick:()=>{o&&o()},className:`confirm-transaction--flag__narrow-box ${t===0?"confirm-transaction--flag__hidden":""}`},_t.default.createElement("img",{src:"/static/images/dapp-flag-left.svg",alt:""})),_t.default.createElement("div",{className:"confirm-transaction--flag--main"},i("wallet_transaction_confirm_subtitle_pending_orders_number",{index:t+1,total:e})),_t.default.createElement("div",{onClick:()=>{r&&r()},className:`confirm-transaction--flag__narrow-box ${t===e-1?"confirm-transaction--flag__hidden":""}`},_t.default.createElement("img",{src:"/static/images/dapp-flag-right.svg",alt:""})))};me.propTypes={index:Q.default.oneOfType([Q.default.number,Q.default.string]),total:Q.default.oneOfType([Q.default.number,Q.default.string]),nextHandle:Q.default.func,prevHandle:Q.default.func};me.defaultProps={index:0,total:0,nextHandle:()=>{},prevHandle:()=>{}};var Wn=me;c();m();var Tt=C(G()),Vn=C(we());c();m();var pe=(t="0",e="0")=>Ke(t,e,{toNumericBase:"hex",multiplicandBase:16,multiplierBase:16});function jn({amount:t="0x0",balance:e="0x0",conversionRate:o=1,gasTotal:r="0x0",primaryCurrency:i}){let p=ze(t,r,{aBase:16,bBase:16,toNumericBase:"hex"});return Ze({value:e,fromNumericBase:"hex",fromCurrency:i,conversionRate:o},{value:p,fromNumericBase:"hex",conversionRate:o,fromCurrency:i})}c();m();var zn=(t,e)=>{var s,l;let o=g(en),r=g(un),i=g(on);if(((s=r[t])==null?void 0:s.includes(i))&&o[i].account[oe]===e)return o[i]||{};let p=(l=r[t])==null?void 0:l.find(f=>{var x;return((x=o[f])==null?void 0:x.account[oe])===e});return p?o[p]:{}};c();m();var Kn=C(G());function Zn(t){return(0,Kn.useCallback)(()=>{if(!t)return null;let r={"0x39509351":S.TOKEN_METHOD_INCREASE_ALLOWANCE},p=Le(t).slice(0,10);return r[p]},[t])()}function qn({params:t}={}){var Ce,he,Ie;let e=k(),o=Ao(),r=be(),i=g(an),p=g(nn),s=g(u=>({nickname:u.metamask.provider.nickname,type:u.metamask.provider.type})),l=r.filter(u=>u.localType===s.type)[0],f=l&&i.find(u=>u.coinId===l.coinId),{confirmTransaction:x,metamask:y}=g(u=>u),{txData:I}=x,{conversionRate:B,unapprovedTxs:Jt,provider:{chainId:$o}}=y,{txParams:to={},id:a,type:F,extParams:D={}}=I,{id:rt}=t,{symbol:at,chainName:kt,image:Ho,coinId:Ft}=g(ne),v=Object.values(Jt).find(({id:u})=>u===(a||Number(rt)))||{},{from:Gt,to:bt,gasPrice:M,maxFeePerGas:Dt,maxPriorityFeePerGas:Mt,gas:J,value:Nt,data:it}=v&&v.txParams||to,Uo=Zn(it),{gasLimit:At,gasPrice:Ct,maxFeePerGas:ht,maxPriorityFeePerGas:Ro,gasType:It,supportEip1559:st}=g(u=>Fo(u,a)||{}),tt=g(ne);(0,Tt.useEffect)(()=>{o(Ot.setCurrentTxData({currentTxData:(0,Vn.cloneDeep)(I)}))},[I,v]);let[ct,Bo]=(0,Tt.useState)(0);(0,Tt.useEffect)(()=>{(async()=>{let{baseCoinToCurrencyRate:u}=await En(tt);Bo(u)})()},[]);let N=B||ct,oo=v.txParams||{},eo={...v,txParams:{...oo,gas:b(At),gasPrice:b(Ct),maxFeePerGas:b(ht)}};st&&(oo.type=Co.FEE_MARKET,delete eo.txParams.gasPrice);let{hexTransactionAmount:Lt,hexTransactionFee:$t,hexTransactionTotal:no}=g(u=>cn(u,eo,ct)),ro=g(dn),Ht=Ge(E,te,Jo,u=>Fe(u,tt.vdecimalNum),u=>Ee.thousandFormat(u,{needZero:!0})),ao=Ht($t),io=ke(Jo(te(E(Lt))),tt.vdecimalNum),Yo=Ht(no),[,{value:Wo}]=ko(no,{rate:ct}),[,{value:so}]=ko(Lt,{}),[,{value:Ut}]=ko($t,{}),co=g(rn),Rt=vn(st?ht:Ct,At,tt),yt=`${co}${(io*ct).toFixed(2)}`,po={topTitle:`${{standard:e("wallet_transfer_subtitle_trading_speed_average"),fast:e("wallet_transfer_subtitle_trading_speed_fast"),slow:e("wallet_transfer_subtitle_trading_speed_slow"),custom:e("wallet_transfer_gasfee_subtitle_gasfee_custom")}[It||Zt.STANDARD]} ${ao} ${at} `,bottomTitle:Rt},{origin:lo}=v,{tokenAmount:uo}=g(sn),{walletName:zo,keyringName:Ko,walletId:fo}=zn(lo,Gt),vt=On(),Bt=(Ce=I==null?void 0:I.txParams)==null?void 0:Ce.to,Yt=Bt&&(vt==null?void 0:vt.find(({address:u})=>De(Bt,u,{baseCoinId:Ft}))),{symbol:K,image:Zo,decimals:_o}=Yt||{},Wt=g(wn);(0,Tt.useEffect)(()=>{o(Ot.setCurrentTxId({txId:a}))},[a]),(0,Tt.useEffect)(()=>{Wt!==K&&o(Ot.setCurrentTxTokenSymbol({txId:a,tokenSymbol:K}))},[Wt,Yt]),Gn({address:Bt,network:f,type:F,baseCoinId:Ft});let mt=0,pt=0,jt=0,To="";if(F===S.TOKEN_METHOD_APPROVE){pt=Xe(to.data);let u=Qe(pt);To=qe(pt),jt=pt&&Ve(u,_o).toFixed(),mt=jt}let lt={...I,...v},Vo={coins:[]},_=g(({metamask:u})=>{var go,Et;return((Et=(go=u.balance[fo])==null?void 0:go.coins)==null?void 0:Et.length)>0?u.balance[fo]:Vo}),T="",d=(he=_.coins.find(u=>u.coinId===Ft))==null?void 0:he.coinAmountInt,U=g(Pn),ot=!1;F===S.TOKEN_METHOD_APPROVE&&(Number(mt)===0&&!U?(ot=!0,T=e("wallet_approval_subtitle_revoke_approval_desc",{tokenSymbol:K})):T=e("wallet_dapp_conncetion_alert_approve_tip",{name:((Ie=ro[lt.origin])==null?void 0:Ie.name)||q,tokenSymbol:K}));let pr=st?ht:Ct,xe=b(At),Ne=b(pr),lr=d?jn({amount:Nt,gasTotal:pe(xe,Ne),balance:b(d),conversionRate:N}):!1,dr=Number(d)>Number(E(pe(xe,Ne))),qo="";F?qo=tn(e,F,at,mt):qo=e("wallet_transfer_dapp_conncetion_subtitle_contracrt_interaction");let Ae=g(Pt),ur=Ae.length,fr=Object.keys(Jt).findIndex(u=>u===a);return{getSendInfo:()=>({nativeCurrencyImage:Ho,functionType:qo,fullTxData:lt,fromAddress:Gt,walletName:`${Ko} - ${zo}`,toAddress:bt,gasLimit:At,amount:Nt,data:it,gasPrice:Ct,supportEip1559:st,maxFeePerGas:ht,maxPriorityFeePerGas:Ro,network:kt||s.type,chainId:$o,origin:lo,comment:T,balance:d,currentNetwork:s,gasFeeDecem:ao,amountDecem:io,amountDecemDisplay:yt,totalCostDecem:Yo,totalCurrency:Wo,gasFeeCurrency:Ut,amountCurrency:so,nativeCurrency:at,type:F,formatGas:po,authorizedAmount:mt,isRevokeAuthorizedAmount:ot,tokenAddress:To,txId:a,coin:tt,value:E(Nt),methodName:Uo,extParams:D}),getCurrencyNetworkInfo:()=>r.find(u=>u.type===s.type),getIndex:()=>({txDataList:Ae,total:ur,index:fr}),getOriginInfo:()=>ro[lt.origin]||{},getGasInfoFromDappTxData:()=>{let go=((D==null?void 0:D.useDefaultGasLimit)||F===S.DEPLOY_CONTRACT)&&J?J:void 0,Et=(D==null?void 0:D.gasType)===Zt.CUSTOM||F===S.DEPLOY_CONTRACT,_r=Et&&M?M:void 0,Tr=Et&&Dt?Dt:void 0,gr=Et&&Mt?Mt:void 0,ye=(D==null?void 0:D.gasType)||Zt.STANDARD;return F===S.DEPLOY_CONTRACT&&(ye=Zt.CUSTOM),{txId:a,gasType:ye,gasLimit:E(go),gasPrice:E(_r),maxFeePerGas:E(Tr),maxPriorityFeePerGas:E(gr)}},getTxData:()=>lt,isSufficientBalance:lr,isSufficientGas:dr,submitData:{tokenAmount:uo,conversionRate:N,currentCurrency:p,tokenSymbol:K,origin:I.origin,hexTransactionAmount:Lt},authorizedInfo:{tokenData:pt,tokenAmount:uo,_tokenAmount:jt,tokenSymbol:K,tokenSymbolImage:Zo,decimals:_o,data:it}}}c();m();var bo=C(G());function Qn(t,e,o){let[r,i]=(0,bo.useState)(!1),p=g(l=>{var f,x,y;return(y=(x=(f=l==null?void 0:l.confirmTransaction)==null?void 0:f.txData)==null?void 0:x.extParams)==null?void 0:y.canSupplyGas}),s=g(({metamask:l})=>{let f,{selectedWallet:x,keyringIdentities:y}=l;return y.find(I=>(f=I.walletIdentities.find(B=>B.walletId===x),f)),[...new Set(Object.values(f.account))]});return(0,bo.useEffect)(()=>{p&&(!e||!t)&&An({userWalletAddresses:s,deviceId:""}).then(l=>{let{gasStationSupportChainList:f=[],isInBlackList:x}=l.data,y=x!==1&&f.some(I=>I.chainId===E(o));i(y)})},[p,e,t]),r}c();m();c();m();var gt=C(G()),le=C(se());var Nr=({title:t,value:e,icon:o,className:r,onClick:i,arrow:p,extraDom:s,color:l})=>gt.default.createElement("div",{className:(0,le.default)("confirm-transaction--item",{"confirm-transaction--item-normal":!s},r),onClick:()=>{i&&i()}},gt.default.createElement("div",{className:"confirm-transaction--title"},t),gt.default.createElement("div",{className:"confirm-transaction--value confirm-transaction--value-normal"},o&&gt.default.createElement(dt,{width:20,height:20,alt:"",src:o||wt,errorImg:wt,className:"confirm-transaction--text-image"}),gt.default.createElement("span",{className:(0,le.default)({"confirm-transaction--color-text":l})},e),p&&gt.default.createElement("img",{src:"/static/images/dapp-arrow-right.svg",className:"confirm-transaction--next-router"})),s),nt=Nr;c();m();var xt=C(G());var Ar=({title:t,value:e,icon:o,onCopy:r})=>xt.default.createElement("div",{className:"confirm-transaction--item confirm-transaction--item-copy"},xt.default.createElement("div",{className:"confirm-transaction--title"},t),xt.default.createElement("div",{className:"confirm-transaction--value confirm-transaction--value-copy"},o&&xt.default.createElement(dt,{width:20,height:20,alt:"",src:o||wt,errorImg:wt,className:"confirm-transaction--text-image"}),xt.default.createElement("span",null,e),xt.default.createElement("img",{onClick:()=>{r&&r()},src:"/static/images/dapp-copy.svg",className:"confirm-transaction--copy"}))),Xn=Ar;c();m();var j=C(G());var Cr=({title:t,value:e,baseCoin:o,isSufficientBalance:r,canUseGasStation:i,onClick:p,supplyGasHandle:s,isOffline:l})=>{let f=k();return j.default.createElement("div",{className:"confirm-transaction--item large",onClick:()=>{l||p&&p()}},j.default.createElement("div",{className:"confirm-transaction--title"},t),j.default.createElement("div",{className:"confirm-transaction--value"},j.default.createElement("div",{className:"confirm-transaction--multi"},j.default.createElement("span",{className:"confirm-transaction--multi-top"},e.topTitle),j.default.createElement("span",{className:"confirm-transaction--multi-bottom"},e.bottomTitle)),!l&&j.default.createElement("img",{alt:"next",src:"/static/images/dapp-arrow-right.svg",className:"confirm-transaction--next-router"})),!r&&!l&&j.default.createElement("div",{className:"confirm-transaction--insufficient-gas"},f("wallet_extension_popup_insufficient_network_fee",{token:o}),i&&j.default.createElement("span",{className:"confirm-transaction--supply-gas",onClick:x=>{x.stopPropagation(),s()}},f("wallet_extension_placeorder_textbtn_replenish",{token:o}))))},Jn=Cr;c();m();var z=C(G());var de=C(se()),hr=({scrollRef:t,title:e,value:o,onCopy:r})=>{let i=k(),[p,s]=(0,z.useState)(0);hn(()=>{t&&t.current&&s(t.current.scrollHeight)});let[l,f]=(0,z.useState)(!0);return z.default.createElement("div",{className:"confirm-transaction--item"},z.default.createElement("div",{className:"confirm-transaction--title"},e),z.default.createElement("img",{onClick:()=>{f(!l),t&&t.current&&setTimeout(()=>{t.current.scrollTo(0,p+350)},0)},src:"/static/images/up-arrow.svg",className:(0,de.default)("confirm-transaction--fold",{"confirm-transaction--fold-reserver":l})}),z.default.createElement("div",{className:(0,de.default)("confirm-transaction--value confirm-transaction--data",{"confirm-transaction--display":l})},z.default.createElement(xo,{style:{margin:"20px 0",zIndex:"9"},title:i("wallet_receive_btn_copy_address"),type:xo.TYPES.neutral,prefixClassName:"confirm-transaction--tooltip",trigger:xo.TRIGGER_TYPES.hover},z.default.createElement("span",{onClick:()=>{r&&r(o)}},o))))},tr=hr;c();m();var Qt=C(G()),or=C(Pe());var Ir=({icon:t,name:e,tokenAddress:o})=>{let r=k();return Qt.default.createElement(Qt.default.Fragment,null,Qt.default.createElement(w.Normal,{title:r("wallet_extension_popup_text_project"),value:e||q,icon:t||qt}),o&&Qt.default.createElement(w.Copy,{title:r("wallet_extension_popup_text_project_contract"),value:W(o),onCopy:()=>{(0,or.default)(o),Z.success({title:r("wallet_transaction_history_toast_address_copied"),desc:o,containerClassName:"address-copy-notification"})}}))},er=Ir;nt.Normal=nt;nt.Copy=Xn;nt.Gas=Jn;nt.Fold=tr;nt.Project=er;var w=nt;c();m();function ue(t){let{isGasLimitLoading:e,gasLimit:o,gasPrice:r,maxFeePerGas:i,maxPriorityFeePerGas:p,supportEip1559:s}=t;return e||Kt(o,0)||s&&(Kt(i,0)||Kt(p,0))||!s&&Kt(r,0)}c();m();c();m();var X=C(G());c();m();function yr({chainId:t,toAddress:e,safeAddressData:o,txType:r}){let i=k(),[p,s]=(0,X.useState)(null),l=(0,X.useMemo)(()=>{if((o==null?void 0:o.approveType)===et.SET_APPROVE_FOR_ALL){if(p){let I={approved_address:W(o.approveAddress),approved_asset:p.name||i("wallet_extension_contract_interaction_unknownnft_collection")};if(r===R.NFT_AUTHORIZATION)return{key:"wallet_extension_contract_interaction_approve_access",args:I};if(r===R.NFT_CANCEL_AUTHORIZATION)return{key:"wallet_extension_contract_interaction_revoke_access",args:I}}}else if((o==null?void 0:o.approveType)===et.INCREASE_ALLOWANCE)return{key:"wallet_extension_contract_interaction_transactiontips",args:{address:W(o.approveAddress)}};return null},[o,r,p]),[f,x]=yn(),y=()=>{f||(x(o.approveAddress),Z.success({title:i("wallet_extension_toast_address_copied"),desc:X.default.createElement("div",{className:"dapp-confirm-approval-method-warning__copy-desc"},o.approveAddress)}))};return(0,X.useEffect)(()=>{(o==null?void 0:o.approveType)===et.SET_APPROVE_FOR_ALL&&Nn({chain:Number(E(t||"0x1")),contractAddress:e}).then(({data:B})=>{s(B)}).catch(()=>{s({})})},[o]),l?X.default.createElement("div",{className:"dapp-confirm-approval-method-warning",onClick:y},i(l.key,l.args||{})):null}var fe=yr;var vr="/static/images/tx-history/default-nft.svg",nr=({text:t,link:e})=>n.default.createElement("div",{className:"confirm-transaction--warning-main"},n.default.createElement("img",{className:"confirm-transaction--warning-icon",src:"/static/images/circle-warning.svg",alt:"warning"}),n.default.createElement("div",{className:"confirm-transaction--warning-text"},n.default.createElement("span",null,t),e)),Er=()=>{let t=k(),e=je(),o=We(),r=Ao(),{getSendInfo:i,getTxData:p,getIndex:s,getOriginInfo:l,getGasInfoFromDappTxData:f,isSufficientBalance:x,authorizedInfo:y,isSufficientGas:I}=qn({params:e}),{tokenSymbol:B,tokenSymbolImage:Jt}=y,$o=[R.NFT_AUTHORIZATION,R.NFT_CANCEL_AUTHORIZATION],{currentLocaleObject:to}=g(({metamask:_})=>({currentLocaleObject:(0,Mo.find)(Yn,{code:_.currentLocale})})),a=i(),{fromAddress:F,toAddress:D,coin:rt,value:at,data:kt,txId:Ho,extParams:Ft}=a,v=l(),{total:Gt,txDataList:bt}=s(),M=p(),Dt=(0,n.useRef)(0),Mt=Qn(I,x,a.chainId),{isOffline:J}=M,{amountDecimal:Nt}=Ft,it=g(_=>Fo(_,a.txId)||{}),{gasLimit:Uo,gasPrice:At,maxFeePerGas:Ct,maxPriorityFeePerGas:ht,supportEip1559:Ro,gasLimitInfo:It={}}=it,st=(M==null?void 0:M.txParams)||{},[tt,Te]=(0,n.useState)(!1),[ct,Bo]=(0,n.useState)(!1),[N,oo]=(0,n.useState)({}),[eo,{setFalse:Lt}]=ce(!0),[$t,{setTrue:no,setFalse:ro}]=ce(!1),[Y,ge]=(0,n.useState)(null),Ht=async _=>{try{let{data:T=[]}=await gn(_),d=!1,U;return T.map((ot={})=>(ot.checkType===ut.SAFE_ADDRESS&&(d=ot.result===!1,U=ot),ot.checkType===ut.OVERWRITTEN&&(Dt.current=ot.newNonce),null)),{isScamAddress:d,safeAddressData:U}}catch{rr.default.error("Call postTxToastCheck Api failed")}return{safeAddressData:{}}},{gasType:ao,gasLimit:io,gasPrice:Yo,maxFeePerGas:Wo,maxPriorityFeePerGas:so}=f();(0,n.useEffect)(()=>{if(a.tokenAddress&&rt.coinId){let _={checkTypes:[ut.SAFE_ADDRESS,ut.OVERWRITTEN],coinId:rt.coinId,from:F,amount:at,to:a.toAddress,inputData:kt,domain:a.origin,projectAddress:a.tokenAddress};(async()=>{let{isScamAddress:T}=await Ht(_);Te(T)})()}},[a.tokenAddress]),(0,n.useEffect)(()=>{if(a.toAddress&&rt.coinId){let _={checkTypes:[ut.SAFE_ADDRESS,ut.OVERWRITTEN],coinId:rt.coinId,from:F,amount:at,to:a.toAddress,inputData:kt,domain:a.origin};(async()=>{let{isScamAddress:T,safeAddressData:d}=await Ht(_);Bo(T),ge(d)})()}},[a.toAddress]),(0,n.useEffect)(()=>{let _=a.chainId||"0x1",T={contractAddress:st.to,chainId:Number(E(_)),inputData:st.data};(async()=>{try{let{data:d}=await xn(T);oo(d)}catch{}finally{Lt()}})()},[]);let Ut=bt.findIndex(_=>_.id===Number(e.id)),co=()=>{no(),r(fn((T=>{let d=(0,Mo.cloneDeep)(T);Ro?(d==null||delete d.txParams.gasPrice,d.txParams.maxFeePerGas=b(Ct),d.txParams.maxPriorityFeePerGas=b(ht),d.txParams.type=Co.FEE_MARKET):(d==null||delete d.txParams.maxFeePerGas,d==null||delete d.txParams.maxPriorityFeePerGas,d==null||delete d.txParams.type,d.txParams.gasPrice=b(At)),d.txParams.gas=b(Uo);let U=Dt.current;return U&&(d.txParams.nonce=b(U)),d.gasLimitInfo=It||{},d})(M),!0)).then(T=>{let{serverTxId:d}=T||{};$e({tx_id:d}),ro()}).catch(()=>{console.log("updateAndApproveTx error")})},mo=async()=>{ae(""),await r(ie({id:M.id})),ft(),o.push(mn)},Rt=a.isRevokeAuthorizedAmount?"cancelApprove":a.type,yt=Rt==="cancelApprove"||Rt==="approve",jo=ct&&a.toAddress||tt&&a.contractAddress,po=ct||tt,lo=!I||!x||ue(it),uo=n.default.createElement("div",{className:"confirm-transaction--button-group"},n.default.createElement(O,{category:O.CATEGORY.outline,type:O.TYPE.secondary,size:O.SIZE.md,block:!0,onClick:()=>{mo&&mo(),((Y==null?void 0:Y.approveType)===et.SET_APPROVE_FOR_ALL||(Y==null?void 0:Y.approveType)===et.INCREASE_ALLOWANCE)&&He()}},t("wallet_dapp_connection_btn_reject")),n.default.createElement(O,{loading:$t,block:!0,category:O.CATEGORY.fill,type:O.TYPE.highlight,size:O.SIZE.md,disabled:J?ue(it):lo,onClick:()=>{co&&co()}},t("wallet_set_password_btn_confirm"))),zo=()=>{var T;let _=(T=bt[Ut-1])==null?void 0:T.id;_&&(r(ft),o.replace(`${A}/${_}`))},Ko=()=>{var T;let _=(T=bt[Ut+1])==null?void 0:T.id;_&&(r(ft),o.replace(`${A}/${_}`))},fo=n.default.createElement("div",{className:"confirm-transaction--header"},n.default.createElement(dt,{width:56,height:56,alt:"",src:Jt||re,errorImg:re,className:"confirm-transaction--chain-icon"}),n.default.createElement("div",{className:"confirm-transaction--currency-amount"},B),n.default.createElement("div",{className:"confirm-transaction--desc"},a.isRevokeAuthorizedAmount?t("wallet_approval_subtitle_revoke_approval_desc",{tokenSymbol:B}):t("wallet_dapp_conncetion_alert_approve_tip",{name:v.name||q,tokenSymbol:B}))),vt=({desc:_,name:T,src:d,className:U=""})=>n.default.createElement("div",{className:"confirm-transaction--origin"},n.default.createElement(dt,{width:56,height:56,alt:"",src:d||qt,errorImg:qt,className:(0,_e.default)("confirm-transaction--origin-icon",U)}),n.default.createElement("div",{className:"confirm-transaction--origin-name"},T||q),a.origin&&n.default.createElement("div",{className:"confirm-transaction--origin-address"},_)),[Bt,Yt]=(0,n.useState)(!1),[K,Zo]=(0,n.useState)(!0),_o=(0,n.useCallback)(()=>{Yt(!1)},[]),Wt="wallet_extension_popup_title_contract_interaction",mt=t(Mn[Rt]||Wt);(N.txType===R.NFT_AUTHORIZATION||N.txType===R.NFT_CANCEL_AUTHORIZATION)&&(mt=t(Dn[N.txType]||Wt));let{run:pt}=In(_=>{r(Ot.setCustomGasInfo({gasTxId:Ho,gasInfo:_}))},{wait:30}),jt=(0,n.useRef)(null),To=()=>yt?fo:Y?(N.txType===R.NFT_AUTHORIZATION||N.txType===R.NFT_CANCEL_AUTHORIZATION)&&Y.approveType!==et.SET_APPROVE_FOR_ALL?vt({desc:t(bn[N.txType]),name:N.name||q,src:N.image||vr,className:"confirm-transaction--origin-img"}):vt({desc:a.origin,name:v.name||q,src:v==null?void 0:v.icon}):null,lt=async()=>{ae(""),await r(ie({id:M.id})),ft(),await r(Tn());let{origin:_,connectionId:T,chainId:d,type:U}=M;await Oe().emitGas({origin:_,connectionId:T,params:{chainId:Number(E(d)),transactionType:U}})},Vo=()=>po?n.default.createElement(nr,{text:t("wallet_extension_scam_popup_risk_warning_desc",{accountAddress:W(jo)}),link:n.default.createElement(zt,{type:zt.TYPE.primary,withRightIcon:!0,weight:zt.WEIGHT.muted,size:zt.SIZE.xs,onClick:()=>{globalThis.platform.openTab({url:Ln[to.code]})}},n.default.createElement("span",{className:"confirm-transaction--warning-span"},t("wallet_extension_scam_toast_link_view_scams")))}):It!=null&&It.queryGasLimitErrorUseDefault?n.default.createElement(nr,{text:t("wallet_extension_toast_text_unknown_error")}):null;return eo?n.default.createElement(Rn,null):n.default.createElement("div",{className:(0,_e.default)("confirm-transaction--main",{"confirm-transaction--submitting":$t})},n.default.createElement(Sn,{title:mt,closeable:!1,backable:!1}),Gt>1&&n.default.createElement(Wn,{index:Ut,total:Gt,prevHandle:zo,nextHandle:Ko}),Vo(),n.default.createElement("div",{className:"confirm-transaction confirm-transaction--token",ref:jt},To(),n.default.createElement(fe,{chainId:a.chainId,toAddress:a.toAddress,safeAddressData:Y,txType:N==null?void 0:N.txType}),n.default.createElement("div",{className:"confirm-transaction--body"},n.default.createElement(w.Normal,{title:t("wallet_transfer_confirmation_subtitle_wallet"),value:a.walletName}),n.default.createElement(w.Copy,{title:t("wallet_transfer_subtitle_send_address"),value:W(a.fromAddress),onCopy:()=>{(0,Do.default)(a.fromAddress),Z.success({title:t("wallet_transaction_history_toast_address_copied"),desc:a.fromAddress,containerClassName:"address-copy-notification"})}}),a.toAddress&&n.default.createElement(w.Copy,{title:t("wallet_extension_popup_text_interact_with"),value:W(a.toAddress),onCopy:()=>{(0,Do.default)(a.toAddress),Z.success({title:t("wallet_transaction_history_toast_address_copied"),desc:a.toAddress,containerClassName:"address-copy-notification"})}}),(N==null?void 0:N.txType)===R.NFT_AUTHORIZATION&&n.default.createElement(w.Normal,{title:t("wallet_extension_text_approved_asset"),value:t("wallet_extension_approve_all_nft_collection"),color:"#F16514"}),yt&&!a.isRevokeAuthorizedAmount&&n.default.createElement(w.Normal,{title:t("wallet_contract_interaction_approval_permission_authorized_amount"),arrow:!a.isRevokeAuthorizedAmount&&!J,color:!0,value:a.authorizedAmount>=10**13?t("wallet_dapp_connection_subtitle_approval_amount_unlimitied"):`${Me(a.authorizedAmount,J&&Nt?Nt:2)} ${B}`,onClick:()=>{J||(o.push(`${pn}/${M.id}`),Ue())}}),yt&&n.default.createElement(w.Project,{icon:v==null?void 0:v.icon,name:v.name,tokenAddress:a.tokenAddress}),$o.includes(N==null?void 0:N.txType)&&n.default.createElement(w.Project,{icon:N==null?void 0:N.projectIcon,name:N.projectName,tokenAddress:N.projectAddress}),n.default.createElement("div",{className:"confirm-transaction--line"}),n.default.createElement(w.Normal,{title:t("wallet_dapp_conncetion_subtitle_network"),value:a.network,icon:a.nativeCurrencyImage}),n.default.createElement(w.Gas,{title:t("wallet_dapp_conncetion_subtitle_network_fee"),value:a.formatGas,isSufficientBalance:I,baseCoin:a.nativeCurrency,canUseGasStation:Mt,onClick:()=>{Yt(!0)},isOffline:J,supplyGasHandle:lt}),!yt&&n.default.createElement(w.Normal,{title:t("wallet_transation_confirmation_subtitle_total_cost"),value:`${a.totalCostDecem} ${a.nativeCurrency}`,extraDom:!x&&n.default.createElement("div",{className:"confirm-transaction--insufficient-amount"},t("wallet_extension_popup_dapp_insufficient_balance"),I&&Mt&&n.default.createElement("span",{className:"confirm-transaction--supply-gas",onClick:()=>{lt()}},t("wallet_extension_placeorder_textbtn_replenish",{token:a.nativeCurrency})))}),n.default.createElement("div",{className:"confirm-transaction--line"}),a.data&&n.default.createElement(w.Fold,{title:t("wallet_dapp_connection_subtitle_data_label"),value:a.data,onCopy:_=>{(0,Do.default)(_),Z.success({title:t("wallet_backup_wallet_toast_private_key_copied"),duration:1.5,placement:Z.DIRECTION.top})}}))),uo,n.default.createElement(Fn,{visible:Bt,coinId:rt.coinId,address:F,inputData:kt,tokenAddress:D,value:at,onBack:_o,onClose:null,onGasChange:pt,initialGasData:{initialGasType:ao,initialCustomGasLimit:io,initialCustomGasPrice:Yo,initialCustomMaxBaseFee:Se(Wo,so),initialCustomMaxPriorityFee:so}}),po&&n.default.createElement(Xo.Prompt,{visible:K,title:t("wallet_extension_protocol_popup_risk_warning"),alignBottom:!1,hideCloseBtn:!0,infoType:Xo.Prompt.INFO_TYPE.warn,confirmBtnProps:{type:O.TYPE.highlight,size:O.SIZE.lg,category:O.CATEGORY.fill},cancelBtnProps:{category:O.CATEGORY.outline,size:O.SIZE.lg},onCancel:()=>{Zo(!K)},onConfirm:mo,confirmText:t("wallet_extension_address_popup_btn_cancel"),cancelText:t("wallet_extension_address_popup_btn_continue")},n.default.createElement("div",{className:"confirm-transaction--risk-desc"},t("wallet_extension_scam_popup_risk_warning_desc",{accountAddress:W(jo)}))))},Lo=Er;c();m();c();m();c();m();var $=C(G()),ar=C(Qo());var St=class extends $.Component{redirectToTransaction(){let{txData:e}=this.props,{id:o,txParams:{data:r}={},type:i}=e;if(i===S.DEPLOY_CONTRACT){let s=`${A}/${o}${Io}`;return $.default.createElement(V,{to:{pathname:s}})}if(i===S.SENT_ETHER){let s=`${A}/${o}${Vt}`;return $.default.createElement(V,{to:{pathname:s}})}if(r)switch(i){case S.TOKEN_METHOD_TRANSFER:{let s=`${A}/${o}${ho}`;return $.default.createElement(V,{to:{pathname:s}})}case S.TOKEN_METHOD_APPROVE:{let s=`${A}/${o}${yo}`;return $.default.createElement(V,{to:{pathname:s}})}case S.TOKEN_METHOD_TRANSFER_FROM:{let s=`${A}/${o}${vo}`;return $.default.createElement(V,{to:{pathname:s}})}default:{let s=`${A}/${o}${Eo}`;return $.default.createElement(V,{to:{pathname:s}})}}let p=`${A}/${o}${Vt}`;return $.default.createElement(V,{to:{pathname:p}})}render(){let{txData:e}=this.props;if(e.txParams)return this.redirectToTransaction();if(e.msgParams){let o=`${A}/${e.id}${Po}`;return e.type===ee.ETH_DECRYPT?o=`${A}/${e.id}${wo}`:e.type===ee.ETH_GET_ENCRYPTION_PUBLIC_KEY&&(o=`${A}/${e.id}${Oo}`),$.default.createElement(V,{to:{pathname:o}})}return $.default.createElement(So,null)}};ve(St,"propTypes",{txData:ar.default.object});var Pr=(t,e)=>{let{metamask:{unapprovedTxs:o}}=t,{match:{params:r={},url:i}}=e,p=(i==null?void 0:i.match(/\d+/u))&&(i==null?void 0:i.match(/\d+/u)[0]),{id:s}=r,l=s||p,f=Pt(t);return{txData:f.length?o[l]||f[0]:{}}},ir=No(Pr)(St);var sr=ir;var Xt=class extends P.Component{componentDidMount(){let{totalUnapprovedCount:e=0,send:o={},history:r,mostRecentOverviewPage:i,transaction:{txParams:{to:p}={}}={},transactionId:s,paramsTransactionId:l,getTokenParams:f,isTokenMethodAction:x}=this.props;if(!e&&!o.to){r.replace(i);return}x&&f(p);let y=s||l;y&&this.props.setTransactionToConfirm(y)}componentDidUpdate(e){let{setTransactionToConfirm:o,clearConfirmTransaction:r,paramsTransactionId:i,transactionId:p,history:s,mostRecentOverviewPage:l,totalUnapprovedCount:f}=this.props;i&&p&&e.paramsTransactionId!==i?(r(),o(i)):(e.transactionId&&!p&&!f||e.transactionId&&p&&e.transactionId!==p)&&s.replace(l)}render(){let{transactionId:e,paramsTransactionId:o}=this.props;return e&&(!o||o===e)?P.default.createElement(Be,null,P.default.createElement(L,{exact:!0,path:`${A}/:id?${Io}`,component:Go}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${Eo}`,component:Go}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${Vt}`,component:Go}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${ho}`,component:Lo}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${yo}`,component:Bn}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${vo}`,component:Lo}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${Po}`,component:Un}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${wo}`,component:Hn}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${Oo}`,component:$n}),P.default.createElement(L,{exact:!0,path:`${A}/:id?${ln}`,component:Lo}),P.default.createElement(L,{path:"*",component:sr})):P.default.createElement(So,null)}};Xt.propTypes={history:H.default.object.isRequired,totalUnapprovedCount:H.default.number.isRequired,send:H.default.object,setTransactionToConfirm:H.default.func.isRequired,clearConfirmTransaction:H.default.func.isRequired,mostRecentOverviewPage:H.default.string.isRequired,transaction:H.default.object,transactionId:H.default.string.isRequired,paramsTransactionId:H.default.string.isRequired,getTokenParams:H.default.func.isRequired,isTokenMethodAction:H.default.bool.isRequired};Xt.defaultProps={send:{},transaction:{}};var cr=Xt;var wr=(t,e)=>{let{metamask:{send:o,unapprovedTxs:r}}=t,{match:{params:i={}}}=e,{id:p}=i,s=Pt(t),l=s.length,f=l?r[p]||s[0]:{},{id:x,type:y}=f;return{totalUnapprovedCount:l,send:o,unapprovedTxs:r,id:p,mostRecentOverviewPage:Cn(t),paramsTransactionId:p&&String(p),transactionId:x&&String(x),transaction:f,isTokenMethodAction:Je(y)}},Or=t=>({setTransactionToConfirm:e=>{t(kn(e))},clearConfirmTransaction:()=>t(ft()),getTokenParams:e=>t(_n(e))}),mr=Re(Ye,No(wr,Or))(cr);var qs=mr;export{qs as default};

window.inOKXExtension = true;
window.ASSETS_BUILD_TYPE = "publish";

